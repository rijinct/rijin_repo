COPY (select xmlelement(name "dataQualityRule",(select xmlelement(name "ruleList",(select XMLAGG(XMLELEMENT(name rule, xmlforest(p.ruleid as "ruleID",p.rule_class as "ruleClass",p.rule_presentation_name as "ruleName",p.rule_condition as "ruleCondition",p.rule_description as "ruleDescription",initcap(p.dimension) as "typeID",p.objecttype as "objectType",p.schemaname as "schemaName",databasetype as "databaseType",p.tableid as "tableID",upper(p.tablename) as "tableName",column_id as "fieldID",upper(column_name) as "fieldName",column_datatype as "supportDataType",p.threshold,p.action,p.weight,p.createoperator as createOperator, p.createtime as createTime,p.lastmodifyoperator as "lastModifyOperator",p.valuerange as "valueRange",p.enumeration,p.auditExpression as "auditExpression",p.fieldlength as "fieldLength" ))) from (select b.ruleid,a.rule_class ,a.rule_presentation_name,replace(b.rule_condition,'"','''') as rule_condition, case when b.rule_parameter='NONE' then a.rule_description when b.dimension = 'CONSISTENCY' or b.dimension = 'INTEGRITY' then concat(a.rule_description, ' ', '-', '[', b.rule_parameter, ']') else a.rule_description end as rule_description, b.dimension,'field' as "objecttype",'PROJECT' as "schemaname",'BIGDATA' as "databasetype",c.table_id as "tableid", c.table_name as "tablename", c.column_id,c.column_name, c.column_datatype,trunc(b.threshold) as "threshold",'1' as "action",b.weight as "weight",'' as "createoperator",'' as "createtime",'' as "lastmodifyoperator",((case when b.dimension = 'RANGE' then b.rule_parameter  else '' end)) as "valuerange",((case when b.dimension = 'CONFORMITY' then b.rule_parameter  else '' end)) as "enumeration", '' as "auditexpression", ((case when b.dimension = 'CONFORMITY' then CAST(c.column_precision AS varchar)  else '' end)) as "fieldlength" from dq_rules_definition a JOIN dq_fields_score b ON a.rule_id=b.ruleid AND b.source in ('CEM') JOIN (select * from dq_fields_definition where id in (select max(id) from dq_fields_definition where computed_date='DATA_DATE' group by table_name,column_name)) c ON b.field_def_id=c.id)p))q))) TO STDOUT